<!DOCTYPE html>
<html>
<head>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="myCanvas" width="400" height="400"></canvas>
    <button onclick="rewindCanvas()">Rewind</button>

    <script>
        var canvas;
        var context;
        var canvasStates = []; // Mảng lưu trữ các trạng thái của canvas

        // Biến để theo dõi trạng thái vẽ
        var isDrawing = false;

        // Hàm để lưu trạng thái hiện tại của canvas
        function saveCanvasState() {
            var currentState = canvas.toDataURL();
            canvasStates.push(currentState);
        }

        // Hàm để lùi lại trạng thái trước đó
        function rewindCanvas() {
            if (canvasStates.length > 0) {
                var previousState = canvasStates.pop();
                var img = new Image();
                img.src = previousState;
                img.onload = function() {
                    context.clearRect(0, 0, canvas.width, canvas.height);
                    context.drawImage(img, 0, 0);
                };
            }
        }

        // Hàm bắt đầu vẽ
        function startDrawing() {
            canvas = document.getElementById("myCanvas");
            context = canvas.getContext("2d");

            // Bắt đầu vẽ khi chuột được nhấn xuống
            canvas.addEventListener("mousedown", function(event) {
                isDrawing = true;
                context.beginPath();
                context.moveTo(event.clientX - canvas.getBoundingClientRect().left, event.clientY - canvas.getBoundingClientRect().top);
            });

            // Kết thúc vẽ khi chuột được nhả ra
            canvas.addEventListener("mouseup", function() {
                isDrawing = false;
                context.closePath();
                saveCanvasState(); // Lưu trạng thái sau khi vẽ
            });

            // Vẽ khi di chuyển chuột (nếu đang vẽ)
            canvas.addEventListener("mousemove", function(event) {
                if (isDrawing) {
                    context.lineTo(event.clientX - canvas.getBoundingClientRect().left, event.clientY - canvas.getBoundingClientRect().top);
                    context.stroke();
                }
            });
        }

        // Gọi hàm startDrawing để bắt đầu vẽ ngay khi trang được tải
        startDrawing();
    </script>
</body>
</html>
